package com.bbt.kangel.dbtesingsystem.activity;import android.content.Intent;import android.database.Cursor;import android.database.sqlite.SQLiteDatabase;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.RecyclerView;import android.util.Log;import android.view.View;import android.view.animation.AnimationUtils;import android.widget.RadioGroup;import com.bbt.kangel.dbtesingsystem.R;import com.bbt.kangel.dbtesingsystem.adapter.TeacherViewGradeAdapter;import com.bbt.kangel.dbtesingsystem.fragment.SelectPaperDialogFragment;import com.bbt.kangel.dbtesingsystem.util.DataBaseHelper;import com.bbt.kangel.dbtesingsystem.util.DialogActivity;import com.bbt.kangel.dbtesingsystem.util.GlobalKeeper;import com.bbt.kangel.dbtesingsystem.util.TestDataBaseUtil;/** * Created by Kangel on 2016/2/17. */public class TeacherViewGradeActivity extends AppCompatActivity implements View.OnClickListener,DialogActivity {    private SQLiteDatabase db;    private Cursor c;    private TeacherViewGradeAdapter adapter;    private RadioGroup radioGroup;    private String PID = "PID";    private SelectPaperDialogFragment selectPaperDialogFragment;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_teacher_view_grade);        DataBaseHelper helper = new DataBaseHelper(TeacherViewGradeActivity.this, GlobalKeeper.DB_NAME, 1);        db = helper.getReadableDatabase();        c = TestDataBaseUtil.getGradesList(db, PID, "PID");        adapter = new TeacherViewGradeAdapter(TeacherViewGradeActivity.this, c);        RecyclerView rv = (RecyclerView) findViewById(R.id.recycle_view);        rv.setHasFixedSize(true);        rv.setLayoutManager(new LinearLayoutManager(this));        rv.setAdapter(adapter);        radioGroup = (RadioGroup) findViewById(R.id.order_rule_list);        radioGroup.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() {            @Override            public void onCheckedChanged(RadioGroup group, int checkedId) {                String orderByString = null;                switch (checkedId) {                    case R.id.button_by_sname: {                        orderByString = "SNAME";                        break;                    }                    case R.id.button_by_sno: {                        orderByString = "SNO";                        break;                    }                    case R.id.button_by_grade: {                        orderByString = "GRADE";                        break;                    }                    case R.id.button_by_pid: {                        orderByString = "PID";                        break;                    }                }                Log.i("order", orderByString);                c.close();                c = TestDataBaseUtil.getGradesList(db,PID, orderByString);                adapter.updateCursor(c);                adapter.notifyItemRangeChanged(0, c.getCount());                toggleOrderList();            }        });    }    @Override    protected void onDestroy() {        super.onDestroy();        if (db != null && db.isOpen()) {            db.close();        }        if (c != null && !c.isClosed()) {            c.close();        }    }    @Override    public void onClick(View v) {        switch (v.getId()) {            case R.id.order_button: {                toggleOrderList();                break;            }            case R.id.show_statistics_button: {                Intent intent = new Intent(TeacherViewGradeActivity.this, ShowStatisticsActivity.class);                Bundle args = new Bundle();                Cursor cursor = db.rawQuery("select max(GRADE) MAX,min(GRADE) MIN,avg(GRADE) AVG from grades where PID = " + PID, null);                cursor.moveToFirst();                args.putInt("max", cursor.getInt(cursor.getColumnIndex("MAX")));                args.putInt("min", cursor.getInt(cursor.getColumnIndex("MIN")));                args.putInt("avg", cursor.getInt(cursor.getColumnIndex("AVG")));                intent.putExtras(args);                cursor.close();                startActivity(intent);                break;            }            case R.id.show_filter_button:{                if (selectPaperDialogFragment == null) {                    selectPaperDialogFragment = new SelectPaperDialogFragment();                }                selectPaperDialogFragment.show(getSupportFragmentManager(), "select");                break;            }        }    }    private void toggleOrderList() {        if (radioGroup.isShown()) {            radioGroup.setAnimation(AnimationUtils.loadAnimation(this, R.anim.anim_slide_up));            radioGroup.setVisibility(View.GONE);        } else {            radioGroup.setAnimation(AnimationUtils.loadAnimation(this, R.anim.anim_slide_down));            radioGroup.setVisibility(View.VISIBLE);        }    }    @Override    public void dismissDialog() {    }    @Override    public void doAtPositiveButton(String tag) {    }    @Override    public void onDialogItemSelect(Bundle args) {        PID = args.getString("PID");        c.close();        c = TestDataBaseUtil.getGradesList(db, PID, "PID");        adapter.updateCursor(c);        adapter.notifyDataSetChanged();        selectPaperDialogFragment.dismiss();    }}